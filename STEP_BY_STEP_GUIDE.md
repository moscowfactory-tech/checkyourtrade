# ðŸš€ ÐŸÐžÐ¨ÐÐ“ÐžÐ’ÐÐ¯ Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯ Ð”Ð›Ð¯ ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜ TIMEWEB

## ðŸ“ Ð“Ð”Ð• Ð’Ð«ÐŸÐžÐ›ÐÐ¯Ð¢Ð¬ ÐšÐžÐœÐÐÐ”Ð«

- ðŸ’» **ÐÐ Ð’ÐÐ¨Ð•Ðœ ÐšÐžÐœÐŸÐ¬Ð®Ð¢Ð•Ð Ð•** - ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ
- ðŸ–¥ï¸ **ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB** - ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¿Ð¾ SSH

---

## Ð¨ÐÐ“ 1: ÐŸÐžÐ›Ð£Ð§Ð•ÐÐ˜Ð• Ð”ÐÐÐÐ«Ð¥ Ð”ÐžÐ¡Ð¢Ð£ÐŸÐ

### ðŸ“§ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ñ‡Ñ‚Ñƒ Ð¾Ñ‚ Timeweb
Ð’Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ñ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸:
- **IP Ð°Ð´Ñ€ÐµÑ:** Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ `185.xxx.xxx.xxx`
- **Ð›Ð¾Ð³Ð¸Ð½:** `root`
- **ÐŸÐ°Ñ€Ð¾Ð»ÑŒ:** Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ `Abc123def456`

**â— Ð¡ÐžÐ¥Ð ÐÐÐ˜Ð¢Ð• Ð­Ð¢Ð˜ Ð”ÐÐÐÐ«Ð•!**

---

## Ð¨ÐÐ“ 2: ÐŸÐžÐ”ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð• Ðš Ð¡Ð•Ð Ð’Ð•Ð Ð£

### ðŸ’» ÐÐ Ð’ÐÐ¨Ð•Ðœ ÐšÐžÐœÐŸÐ¬Ð®Ð¢Ð•Ð Ð• (Ð² Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ðµ):

```bash
# ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ (Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ IP Ð½Ð° Ð²Ð°Ñˆ)
ssh root@185.xxx.xxx.xxx
```

**Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ð´ÐµÑ‚:**
1. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¿Ñ€Ð¾ÑÐ¸Ñ‚ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ - Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð¸Ð· Ð¿Ð¸ÑÑŒÐ¼Ð°
2. ÐŸÑ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ ÑÐ¿Ñ€Ð¾ÑÐ¸Ñ‚ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐµÑ€Ð²ÐµÑ€ - Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ `yes`
3. Ð’Ñ‹ Ð¿Ð¾Ð¿Ð°Ð´ÐµÑ‚Ðµ Ð² Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» ÑÐµÑ€Ð²ÐµÑ€Ð° (ÑƒÐ²Ð¸Ð´Ð¸Ñ‚Ðµ `root@server:~#`)

---

## Ð¨ÐÐ“ 3: ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð• Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«

### ðŸ–¥ï¸ ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB:

```bash
# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°ÐºÐµÑ‚Ð¾Ð² (Ð·Ð°Ð¹Ð¼ÐµÑ‚ 2-3 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹)
apt update && apt upgrade -y

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ñ‹Ñ… ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚
apt install -y curl wget nano htop
```

**Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚:** ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð¸ ÑƒÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð½ÑƒÐ¶Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹

---

## Ð¨ÐÐ“ 4: Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐ¢Ð•Ð›Ð¯

### ðŸ–¥ï¸ ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB:

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
adduser tradeanalyzer
```

**Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¿Ñ€Ð¾ÑÐ¸Ñ‚:**
- `Enter new UNIX password:` - Ð¿Ñ€Ð¸Ð´ÑƒÐ¼Ð°Ð¹Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: `TradeApp2024`)
- `Retype new UNIX password:` - Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ñ‚Ð¾Ñ‚ Ð¶Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ
- ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ (Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¶Ð¸Ð¼Ð°Ñ‚ÑŒ Enter)

```bash
# Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð°Ð² Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°
usermod -aG sudo tradeanalyzer

# ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
su - tradeanalyzer
```

**Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚Ðµ Ð¿Ð¾Ð´ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼ `tradeanalyzer`**

---

## Ð¨ÐÐ“ 5: ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ POSTGRESQL

### ðŸ–¥ï¸ ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB (Ð¿Ð¾Ð´ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼ tradeanalyzer):

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡Ñ‚Ð¾ PostgreSQL Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
sudo systemctl status postgresql
```

**Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ:** `Active: active (running)`

```bash
# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° PostgreSQL Ð´Ð»Ñ ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ð¸ Ð¿Ð°Ð¼ÑÑ‚Ð¸
sudo nano /etc/postgresql/15/main/postgresql.conf
```

**Ð’ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ðµ nano:**
1. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ `Ctrl+W` Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ°
2. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ ÑÑ‚Ñ€Ð¾ÐºÑƒ `#shared_buffers`
3. Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð°: `shared_buffers = 128MB`
4. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ `#effective_cache_size`
5. Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð°: `effective_cache_size = 512MB`
6. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ `#work_mem`
7. Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð°: `work_mem = 4MB`
8. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ `#max_connections`
9. Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð°: `max_connections = 20`
10. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ `Ctrl+X`, Ð·Ð°Ñ‚ÐµÐ¼ `Y`, Ð·Ð°Ñ‚ÐµÐ¼ `Enter` Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ

```bash
# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº PostgreSQL
sudo systemctl restart postgresql
```

---

## Ð¨ÐÐ“ 6: Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• Ð‘ÐÐ—Ð« Ð”ÐÐÐÐ«Ð¥

### ðŸ–¥ï¸ ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB:

```bash
# ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ postgres
sudo -u postgres psql
```

**Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸ PostgreSQL (Ð²Ð¸Ð´Ð¸Ñ‚Ðµ `postgres=#`)**

**Ð’ ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸ PostgreSQL Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ:**
```sql
-- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
CREATE USER tradeanalyzer_app WITH PASSWORD 'TradeAnalyzer2024!';

-- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
CREATE DATABASE tradeanalyzer OWNER tradeanalyzer_app;

-- ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð°Ð²
GRANT ALL PRIVILEGES ON DATABASE tradeanalyzer TO tradeanalyzer_app;

-- Ð’Ñ‹Ñ…Ð¾Ð´ Ð¸Ð· PostgreSQL
\q
```

**Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹ ÑÐ½Ð¾Ð²Ð° Ð² Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾Ð¼ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»Ðµ**

---

## Ð¨ÐÐ“ 7: Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• Ð¡Ð¥Ð•ÐœÐ« Ð‘Ð”

### ðŸ–¥ï¸ ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB:

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° ÑÐ¾ ÑÑ…ÐµÐ¼Ð¾Ð¹ Ð‘Ð”
nano ~/setup_database.sql
```

**Ð’ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ðµ nano Ð²ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ð¾Ñ‚ ÐºÐ¾Ð´:**
```sql
-- ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð‘Ð”
\c tradeanalyzer;

-- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ð¹
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    telegram_id TEXT UNIQUE NOT NULL,
    username TEXT,
    first_name TEXT,
    last_name TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¹
CREATE TABLE strategies (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    telegram_user_id TEXT,
    name TEXT NOT NULL,
    description TEXT,
    fields JSONB,
    is_public BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¾Ð²
CREATE TABLE analyses (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    telegram_user_id TEXT,
    strategy_id UUID REFERENCES strategies(id) ON DELETE SET NULL,
    strategy_name TEXT,
    coin TEXT,
    date TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    answers JSONB,
    results JSONB,
    recommendation TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸
CREATE VIEW analysis_results AS 
SELECT 
    id, user_id, strategy_id, answers,
    (results->>'positive')::jsonb as positive_factors,
    (results->>'negative')::jsonb as negative_factors,
    (results->>'neutral')::jsonb as neutral_factors,
    recommendation, created_at
FROM analyses;

-- Ð˜Ð½Ð´ÐµÐºÑÑ‹
CREATE INDEX idx_users_telegram_id ON users(telegram_id);
CREATE INDEX idx_strategies_user_id ON strategies(user_id);
CREATE INDEX idx_analyses_user_id ON analyses(user_id);

-- Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹
CREATE TRIGGER update_users_updated_at
    BEFORE UPDATE ON users FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_strategies_updated_at
    BEFORE UPDATE ON strategies FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();

-- ÐŸÑ€Ð°Ð²Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ
GRANT CONNECT ON DATABASE tradeanalyzer TO tradeanalyzer_app;
GRANT USAGE ON SCHEMA public TO tradeanalyzer_app;
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO tradeanalyzer_app;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO tradeanalyzer_app;

-- Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸
CREATE OR REPLACE FUNCTION get_user_stats(p_telegram_id TEXT)
RETURNS JSON AS $$
DECLARE
    user_uuid UUID;
    strategies_count INTEGER;
    analyses_count INTEGER;
BEGIN
    SELECT id INTO user_uuid FROM users WHERE telegram_id = p_telegram_id;
    
    IF user_uuid IS NULL THEN
        RETURN json_build_object('strategies', 0, 'analyses', 0);
    END IF;
    
    SELECT COUNT(*) INTO strategies_count FROM strategies WHERE user_id = user_uuid;
    SELECT COUNT(*) INTO analyses_count FROM analyses WHERE user_id = user_uuid;
    
    RETURN json_build_object('strategies', strategies_count, 'analyses', analyses_count);
END;
$$ LANGUAGE plpgsql;

SELECT 'Database setup completed!' as status;
```

**Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ:** `Ctrl+X`, Ð·Ð°Ñ‚ÐµÐ¼ `Y`, Ð·Ð°Ñ‚ÐµÐ¼ `Enter`

```bash
# Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð‘Ð”
sudo -u postgres psql -f ~/setup_database.sql
```

**Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ:** `Database setup completed!`

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ‚Ð°Ð±Ð»Ð¸Ñ†
sudo -u postgres psql -d tradeanalyzer -c "\dt"
```

**Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ‚Ð°Ð±Ð»Ð¸Ñ†:** `users`, `strategies`, `analyses`

---

## Ð¨ÐÐ“ 8: Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ PYTHON Ð˜ API

### ðŸ–¥ï¸ ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB:

```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Python
sudo apt install -y python3 python3-pip python3-venv

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð°Ð¿ÐºÐ¸ Ð´Ð»Ñ API
mkdir ~/tradeanalyzer_api
cd ~/tradeanalyzer_api

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
python3 -m venv venv
source venv/bin/activate
```

**Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð² Ð½Ð°Ñ‡Ð°Ð»Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ `(venv)`**

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
cat > requirements.txt << EOF
Flask==2.3.3
Flask-CORS==4.0.0
psycopg2-binary==2.9.7
python-dotenv==1.0.0
gunicorn==21.2.0
EOF

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ (Ð·Ð°Ð¹Ð¼ÐµÑ‚ 2-3 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹)
pip install -r requirements.txt
```

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
cat > .env << EOF
DB_HOST=localhost
DB_PORT=5432
DB_NAME=tradeanalyzer
DB_USER=tradeanalyzer_app
DB_PASSWORD=TradeAnalyzer2024!
FLASK_ENV=production
FLASK_DEBUG=False
EOF
```

---

## Ð¨ÐÐ“ 9: Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• API Ð¡Ð•Ð Ð’Ð•Ð Ð

### ðŸ–¥ï¸ ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB:

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð° API
nano app.py
```

**Ð’ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ðµ nano Ð²ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ð¾Ñ‚ ÐºÐ¾Ð´:**
```python
#!/usr/bin/env python3
from flask import Flask, request, jsonify
from flask_cors import CORS
import psycopg2
import psycopg2.extras
import os
import json
from datetime import datetime
from dotenv import load_dotenv

load_dotenv()

app = Flask(__name__)
CORS(app, origins=['*'])

# ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð‘Ð”
DB_CONFIG = {
    'host': os.getenv('DB_HOST', 'localhost'),
    'port': os.getenv('DB_PORT', '5432'),
    'database': os.getenv('DB_NAME', 'tradeanalyzer'),
    'user': os.getenv('DB_USER', 'tradeanalyzer_app'),
    'password': os.getenv('DB_PASSWORD', 'TradeAnalyzer2024!')
}

def get_db_connection():
    try:
        conn = psycopg2.connect(**DB_CONFIG)
        return conn
    except Exception as e:
        print(f"DB error: {e}")
        return None

def execute_query(sql, params=None, fetch=True):
    conn = get_db_connection()
    if not conn:
        return {'data': None, 'error': 'DB connection failed'}
    
    try:
        with conn.cursor(cursor_factory=psycopg2.extras.RealDictCursor) as cur:
            cur.execute(sql, params or [])
            if fetch:
                result = [dict(row) for row in cur.fetchall()]
            else:
                result = []
            conn.commit()
            return {'data': result, 'error': None}
    except Exception as e:
        conn.rollback()
        return {'data': None, 'error': str(e)}
    finally:
        conn.close()

@app.route('/api/health')
def health():
    conn = get_db_connection()
    if conn:
        conn.close()
        return jsonify({'status': 'healthy', 'message': 'TradeAnalyzer API is running!'})
    return jsonify({'status': 'unhealthy'}), 500

@app.route('/api/strategies', methods=['GET'])
def get_strategies():
    telegram_user_id = request.args.get('telegram_user_id')
    if not telegram_user_id:
        return jsonify({'data': [], 'error': None})
    
    sql = """
    SELECT s.* FROM strategies s
    JOIN users u ON u.id = s.user_id
    WHERE u.telegram_id = %s
    ORDER BY s.created_at DESC
    """
    result = execute_query(sql, [telegram_user_id])
    return jsonify(result)

@app.route('/api/strategies', methods=['POST'])
def create_strategy():
    data = request.get_json()
    telegram_user_id = data.get('telegram_user_id')
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ ÐµÑÐ»Ð¸ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
    user_sql = """
    INSERT INTO users (telegram_id, username, first_name, last_name)
    VALUES (%s, %s, %s, %s)
    ON CONFLICT (telegram_id) DO UPDATE SET updated_at = NOW()
    RETURNING id
    """
    user_result = execute_query(user_sql, [
        telegram_user_id,
        data.get('username'),
        data.get('first_name'),
        data.get('last_name')
    ])
    
    if user_result['error']:
        return jsonify({'data': None, 'error': user_result['error']}), 500
    
    user_id = user_result['data'][0]['id']
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸ÑŽ
    strategy_sql = """
    INSERT INTO strategies (user_id, telegram_user_id, name, description, fields)
    VALUES (%s, %s, %s, %s, %s)
    RETURNING *
    """
    result = execute_query(strategy_sql, [
        user_id, telegram_user_id,
        data.get('name'), data.get('description'),
        json.dumps(data.get('fields', []))
    ])
    
    return jsonify(result)

@app.route('/api/analysis_results', methods=['GET'])
def get_analyses():
    telegram_user_id = request.args.get('telegram_user_id')
    if not telegram_user_id:
        return jsonify({'data': [], 'error': None})
    
    sql = """
    SELECT ar.* FROM analysis_results ar
    JOIN users u ON u.id = ar.user_id
    WHERE u.telegram_id = %s
    ORDER BY ar.created_at DESC
    """
    result = execute_query(sql, [telegram_user_id])
    return jsonify(result)

@app.route('/api/analysis_results', methods=['POST'])
def create_analysis():
    data = request.get_json()
    telegram_user_id = data.get('telegram_user_id')
    
    # ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
    user_sql = "SELECT id FROM users WHERE telegram_id = %s"
    user_result = execute_query(user_sql, [telegram_user_id])
    
    if not user_result['data']:
        return jsonify({'data': None, 'error': 'User not found'}), 404
    
    user_id = user_result['data'][0]['id']
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð°Ð½Ð°Ð»Ð¸Ð·
    results = {
        'positive': data.get('positive_factors', []),
        'negative': data.get('negative_factors', []),
        'neutral': data.get('neutral_factors', [])
    }
    
    analysis_sql = """
    INSERT INTO analyses (user_id, telegram_user_id, strategy_id, strategy_name, 
                         coin, answers, results, recommendation)
    VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
    RETURNING *
    """
    result = execute_query(analysis_sql, [
        user_id, telegram_user_id, data.get('strategy_id'),
        data.get('strategy_name'), data.get('coin'),
        json.dumps(data.get('answers', [])),
        json.dumps(results), data.get('recommendation')
    ])
    
    return jsonify(result)

if __name__ == '__main__':
    print("ðŸš€ Starting TradeAnalyzer API...")
    conn = get_db_connection()
    if conn:
        print("âœ… DB connected")
        conn.close()
        app.run(host='127.0.0.1', port=5000, debug=False)
    else:
        print("âŒ DB connection failed")
```

**Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ:** `Ctrl+X`, Ð·Ð°Ñ‚ÐµÐ¼ `Y`, Ð·Ð°Ñ‚ÐµÐ¼ `Enter`

---

## Ð¨ÐÐ“ 10: Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð• API

### ðŸ–¥ï¸ ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB:

```bash
# Ð—Ð°Ð¿ÑƒÑÐº API Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
python app.py
```

**Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ:**
```
ðŸš€ Starting TradeAnalyzer API...
âœ… DB connected
* Running on http://127.0.0.1:5000
```

**ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ ÐÐžÐ’Ð«Ð™ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» Ð½Ð° Ð²Ð°ÑˆÐµÐ¼ ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€Ðµ Ð¸ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÑÑŒ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ:**

### ðŸ’» ÐÐ Ð’ÐÐ¨Ð•Ðœ ÐšÐžÐœÐŸÐ¬Ð®Ð¢Ð•Ð Ð• (Ð½Ð¾Ð²Ñ‹Ð¹ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»):

```bash
# ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ
ssh root@185.xxx.xxx.xxx

# ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
su - tradeanalyzer

# Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ API
curl http://localhost:5000/api/health
```

**Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ:** `{"message":"TradeAnalyzer API is running!","status":"healthy"}`

**Ð’ÐµÑ€Ð½Ð¸Ñ‚ÐµÑÑŒ Ð² Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» Ð¸ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ API:** `Ctrl+C`

---

## Ð¨ÐÐ“ 11: Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ NGINX

### ðŸ–¥ï¸ ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB:

```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Nginx
sudo apt install -y nginx

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
sudo nano /etc/nginx/sites-available/tradeanalyzer
```

**Ð’ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ðµ nano Ð²ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ:**
```nginx
server {
    listen 80;
    server_name _;
    
    client_max_body_size 1m;
    client_body_timeout 10s;
    client_header_timeout 10s;
    
    location /api/ {
        proxy_pass http://127.0.0.1:5000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_connect_timeout 5s;
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
    }
    
    location / {
        return 200 'TradeAnalyzer API is running!';
        add_header Content-Type text/plain;
    }
}
```

**Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ:** `Ctrl+X`, Ð·Ð°Ñ‚ÐµÐ¼ `Y`, Ð·Ð°Ñ‚ÐµÐ¼ `Enter`

```bash
# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
sudo rm /etc/nginx/sites-enabled/default

# ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ Ð½Ð°ÑˆÐµÐ¹ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
sudo ln -s /etc/nginx/sites-available/tradeanalyzer /etc/nginx/sites-enabled/

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
sudo nginx -t

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº Nginx
sudo systemctl restart nginx
sudo systemctl enable nginx
```

---

## Ð¨ÐÐ“ 12: Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• ÐÐ’Ð¢ÐžÐ—ÐÐŸÐ£Ð¡ÐšÐ

### ðŸ–¥ï¸ ÐÐ Ð¡Ð•Ð Ð’Ð•Ð Ð• TIMEWEB:

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐµÑ€Ð²Ð¸ÑÐ° Ð°Ð²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐºÐ°
sudo nano /etc/systemd/system/tradeanalyzer-api.service
```

**Ð’ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ðµ nano Ð²ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ:**
```ini
[Unit]
Description=TradeAnalyzer API
After=network.target postgresql.service
Requires=postgresql.service

[Service]
Type=exec
User=tradeanalyzer
Group=tradeanalyzer
WorkingDirectory=/home/tradeanalyzer/tradeanalyzer_api
Environment=PATH=/home/tradeanalyzer/tradeanalyzer_api/venv/bin
ExecStart=/home/tradeanalyzer/tradeanalyzer_api/venv/bin/gunicorn --bind 127.0.0.1:5000 --workers 1 --timeout 30 --max-requests 1000 app:app
Restart=always
RestartSec=10
MemoryLimit=256M
CPUQuota=50%

[Install]
WantedBy=multi-user.target
```

**Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ:** `Ctrl+X`, Ð·Ð°Ñ‚ÐµÐ¼ `Y`, Ð·Ð°Ñ‚ÐµÐ¼ `Enter`

```bash
# ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ ÑÐµÑ€Ð²Ð¸ÑÐ°
sudo systemctl daemon-reload
sudo systemctl enable tradeanalyzer-api
sudo systemctl start tradeanalyzer-api

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
sudo systemctl status tradeanalyzer-api
```

**Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ:** `Active: active (running)`

---

## Ð¨ÐÐ“ 13: Ð¤Ð˜ÐÐÐ›Ð¬ÐÐžÐ• Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð•

### ðŸ’» ÐÐ Ð’ÐÐ¨Ð•Ðœ ÐšÐžÐœÐŸÐ¬Ð®Ð¢Ð•Ð Ð•:

```bash
# Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ API Ñ‡ÐµÑ€ÐµÐ· Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ IP (Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð²Ð°Ñˆ IP)
curl http://185.xxx.xxx.xxx/api/health
```

**Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ:** `{"message":"TradeAnalyzer API is running!","status":"healthy"}`

---

## ðŸŽ‰ Ð“ÐžÐ¢ÐžÐ’Ðž! Ð¡Ð•Ð Ð’Ð•Ð  ÐÐÐ¡Ð¢Ð ÐžÐ•Ð!

### ðŸ“‹ Ð§Ð¢Ðž Ð£ Ð’ÐÐ¡ Ð•Ð¡Ð¢Ð¬:

âœ… **Ð¡ÐµÑ€Ð²ÐµÑ€ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚**  
âœ… **PostgreSQL Ð±Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¾Ð·Ð´Ð°Ð½Ð°**  
âœ… **API ÑÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½**  
âœ… **Nginx Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ ÐºÐ°Ðº Ð¿Ñ€Ð¾ÐºÑÐ¸**  
âœ… **ÐÐ²Ñ‚Ð¾Ð·Ð°Ð¿ÑƒÑÐº Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½**  

### ðŸ”— **Ð’Ð°Ñˆ API Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ:**
`http://Ð’ÐÐ¨_IP_ÐÐ”Ð Ð•Ð¡/api/`

### ðŸ“ **Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ ÑˆÐ°Ð³:**
ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Ð² Ð²Ð°ÑˆÐµÐ¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸ Ð´Ð»Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð½Ð¾Ð²Ð¾Ð¼Ñƒ ÑÐµÑ€Ð²ÐµÑ€Ñƒ.

**Ð¡Ð¾Ð¾Ð±Ñ‰Ð¸Ñ‚Ðµ Ð¼Ð½Ðµ Ð²Ð°Ñˆ IP Ð°Ð´Ñ€ÐµÑ ÑÐµÑ€Ð²ÐµÑ€Ð°, Ð¸ Ñ Ð¿Ð¾Ð¼Ð¾Ð³Ñƒ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ!** ðŸš€
